<!DOCTYPE html>

<html lang="en">

        <head>
                <!-- Page information -->
                <meta charset="UTF-8" />
                <meta name="node_id" content="gsoc devlog (june)">
                <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                <link rel="shortcut icon" href="/notes/favicon.ico" />

                <!-- Set title -->
                <title>CheerfulP's Notes</title>

                <!-- Includes -->
                <script src="/notes/obs.html/static/obsidian_core.js"></script>
<script src="/notes/obs.html/static/encoding.js"></script>
<link rel="stylesheet" href="/notes/obs.html/static/master.css" />
<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
            'securityLevel': 'loose',
            'theme': 'dark',
            'themeVariables': {
                    'darkMode': true,
            }
    });
</script>
<script>
  MathJax = {
    loader: {
      load: [
        '[tex]/action',
        'output/chtml',
        '[tex]/centernot'
      ]
    },
    tex: {
      inlineMath: [ ["\\(","\\)"] ],
      displayMath: [ ["\\[","\\]"] ],
      processEscapes: true,
      processEnvironments: true,
      packages: {'[+]': ['centernot']}
    }
  };
</script>
<script type="text/javascript" id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
<script src="/notes/obs.html/static/flexsearch.bundle.js"></script>
<script src="/notes/obs.html/static/pako.js"></script>
<script src="/notes/obs.html/static/search.js"></script>
<script src="/notes/obs.html/static/dirtree.js"></script>




                <!-- Onload tweaks -->
                <script>
                        const CURRENT_NODE = 'gsoc devlog (june)';
                        const HTML_URL_PREFIX = '/notes';
                        const PAGE_DEPTH = 1;
                </script>
        </head>

<body class="theme-obs-light">
        <div id="antiflash" style="display: none;"></div>
        <script>
                document.getElementById('antiflash').style.display = 'block';
        </script>
        <div id="search-master-div">
    <div id="search-slab" king_ramses="return the slaaab">
            <div id="search-controls">
                    <input id="search_string" placeholder="Type to search notes" type="text" />
                    <div class="tooltip" style="display: none;">
                        <input type="checkbox" id="hard_search" name="hard" />
                        <span class="tooltiptext">Hard search (require exact match)</span>
                    </div>
                    <div id="search-results-box">
                        <div id="search-results"></div>
                    </div>
                    <div id="search-instructions">
                        <div class="prompt-instruction mobile">
                            <button onclick="toggle_id('search-master-div');"><b>Close</b> Search </button>
                        </div>
                    </div>
            </div>
    </div>
</div>

<script>
    document.getElementById("search-master-div").addEventListener('click', e => {
            if(e.target !== e.currentTarget){
                    return
            }
            toggle_id('search-master-div');
    })
    document.getElementById("search_string").addEventListener("input", function(event) {
            setTimeout( () =>run_search('search_string', 'hard_search'), 100 );
    }); 
    document.getElementById("hard_search").addEventListener("click", function(event) {
            setTimeout( () =>run_search('search_string', 'hard_search'), 100 );
    });

    window.addEventListener('keydown', e => {
        if((e.key=='Escape'||e.key=='Esc'||e.keyCode==27)){
            toggle_id('search-master-div');
            return false;
        } 
    }, true);

    function click_list_link(element){
        element.parentElement.getElementsByTagName('a')[0].click()
    }
</script>

        <div id="page_holder" class="flex_col">
                <div id="header" class="header">
    <div id="header_flex" class="flex_row">
            <a href="/notes/index.html" id="homelink" title="Clear screen and go to homepage">CheerfulP's Notes</a>
            <div id="menu_toggle_button" class="navbar-button requires_js" onclick="toggle_menu()">
                    â‰¡
            </div>
            <div id="navbar" class="navbar requires_js">
                    <a class="navbar-link" href="/notes/index.html" title="Home">Home</a>
<a class="navbar-link" href="/notes/GSOC/GSOC.html" title="GSoC 2024">GSoC 2024</a>
                    <div class="icon-tray">
                            <div id="theme-button" class="theme-button requires_js" title="Change theme" onclick="toggle_theme_popup(this)">
    T
</div>
<script>
    function toggle_theme_popup(el){
        // make theme button show that it's active by adding the .active class
        toggle(el);

        // show the theme selector
        toggle_id('theme-popup')

        let h2 = document.getElementById('header2')
        if (h2){
            let pu = document.getElementById('header2').getElementsByClassName('popup')[0];
            toggle(pu);
        }
    }

    function disable_theme_popup(){
        disable_id('theme-button');

        // show the theme selector
        disable_id('theme-popup')

        let h2 = document.getElementById('header2')
        if (h2){
            let pu = document.getElementById('header2').getElementsByClassName('popup')[0];
            disable(pu);
        }
    }
</script>
                                    <div onclick="openSearch()" class="theme-button requires_js">
            <img src = "/notes/obs.html/static/search.svg" alt="Search notes" title="Search notes" style="margin: 4px;"/>
        </div>
        <script>
            function openSearch(){
                // toggle search popup and continue with extra code if it is enabled this time
                if (toggle_id('search-master-div')){
                    // get input field and temporarily disable it
                    let ss = document.getElementById('search_string');
                    ss.value = 'Seach data initializing...';
                    ss.readOnly = true; 

                    // load search data if not yet done so
                    setTimeout(function(){
                        LoadSearchData()

                        // clear input and put focus on it so that we can start typing immediately
                        ss.value = '';
                        ss.readOnly = false; 
                        ss.focus()
                        ss.select()
                    }, 100);
                }
            }
        </script>
                                    <div class="graph_header_div requires_js">
            <a id="graph_link" class="system-link" href="/notes/obs.html/graph/index.html?node=gsoc devlog (june)" title="Open fullpage Graph">
                    <img class="graph_header_div_svg" src = "/notes/obs.html/static/graph.svg" alt="Open fullpage Graph" style="margin: 2px; width: 17px;"/>
            </a>
        </div>
                                    <div >
            <a id="dirtree_link" class="system-link" href="/notes/obs.html/dir_index.html" title="View directory tree">
                    <img src = "/notes/obs.html/static/dirtree.svg" style="width: 12px; padding: 4px;" alt="Directory tree link"/>
            </a>
        </div>
                            <div>
    <a href="/notes/obs.html/tags/index.html" title="Open tag view">
            <img src = "/notes/obs.html/static/hashtag.svg" alt="RSS Feed link" style="width: 24px; margin-left: -2px; margin-top: -2px;"/>
    </a>
</div>
                                    <div>
            <a id="rss_link" class="system-link" href="/notes/obs.html/rss/feed.xml" title="RSS Feed link">
                    <img src = "/notes/obs.html/static/rss.svg" alt="RSS Feed link"/>
            </a>
        </div>
                    </div>
                    <div style="display: flex; flex-direction:column">
                        <div id="left_pane_toggle_nav" class="left_pane_toggle_nav">Toggle Directory Tree Pane</div>
                        <div id="right_pane_toggle_nav" class="right_pane_toggle_nav">Toggle Table of Contents Pane</div>
                    </div>
            </div>
    </div>
    <div class="popup" id="theme-popup">
    <label for="cars">Theme </label>

    <select name="theme" id="theme" onchange="set_theme(this.value)">
      <option value="obs-light" selected="selected">obsidian-light</option>
      <option value="obs-dark">obsidian-dark</option>
    </select> 
</div>
</div>
                <div class="flex_row">
                        <div id="left_pane" class="left_pane active">
    <div id="left_pane_fold_header" class="left_pane_fold_header fold_header">x</div>
    <div id="left_pane_content" class="left_pane_content">
            <div id="dirtree"><button id="folder-1" class="dir-button active" onclick="toggle_dir(this.id)"><div class="file-icon"></div>GSOC</button>
<div id="folder-container-1" class="dir-container requires_js active" path="/notes/GSOC">
	<ul class="dir-list">
		<li><div class="file-icon"></div><a class="" href="/notes/GSOC/GSOC.html"  >GSOC</a></li>
		<li><div class="file-icon"></div><a class="" href="/notes/GSOC/GSoC Changelog.html"  >GSoC Changelog</a></li>
		<li><div class="file-icon"></div><a class="" href="/notes/GSOC/GSoC Devlog (August).html"  >GSoC Devlog (August)</a></li>
		<li><div class="file-icon"></div><a class="" href="/notes/GSOC/GSoC Devlog (July).html"  >GSoC Devlog (July)</a></li>
		<li><div class="file-icon"></div><a class="active current_page_dirtree" href="/notes/GSOC/GSoC Devlog (June).html"  >GSoC Devlog (June)</a></li>
		<li><div class="file-icon"></div><a class="" href="/notes/GSOC/GSoC Devlog (May).html"  >GSoC Devlog (May)</a></li>
		<li><div class="file-icon"></div><a class="" href="/notes/GSOC/GsoC Research Links.html"  >GsoC Research Links</a></li>
		<li><div class="file-icon"></div><a class="" href="/notes/GSOC/Project Design.html"  >Project Design</a></li>
		<li><div class="file-icon"></div><a class="" href="/notes/GSOC/Project Motivation.html"  >Project Motivation</a></li>
		<li><div class="file-icon non-md-file"></div><a class="" href="/notes/GSOC/Waycrate_GSOC_2024.pdf"  class="external-link">Waycrate_GSOC_2024.pdf</a></li>
	</ul>
</div>
<button id="folder-2" class="dir-button " onclick="toggle_dir(this.id)"><div class="file-icon"></div>_attachments</button>
<div id="folder-container-2" class="dir-container requires_js " path="/notes/_attachments">
	<ul class="dir-list">
		<li><div class="file-icon non-md-file"></div><a class="" href="/notes/_attachments/Pasted image 20240619212710.png"  class="external-link">Pasted image 20240619212710.png</a></li>
		<li><div class="file-icon non-md-file"></div><a class="" href="/notes/_attachments/Pasted image 20240730174837.png"  class="external-link">Pasted image 20240730174837.png</a></li>
		<li><div class="file-icon non-md-file"></div><a class="" href="/notes/_attachments/Pasted image 20240730180003.png"  class="external-link">Pasted image 20240730180003.png</a></li>
		<li><div class="file-icon non-md-file"></div><a class="" href="/notes/_attachments/Pasted image 20240730180043.png"  class="external-link">Pasted image 20240730180043.png</a></li>
		<li><div class="file-icon non-md-file"></div><a class="" href="/notes/_attachments/proposal_image1.png"  class="external-link">proposal_image1.png</a></li>
		<li><div class="file-icon non-md-file"></div><a class="" href="/notes/_attachments/wayshot-2024_05_14-18_34_28.png"  class="external-link">wayshot-2024_05_14-18_34_28.png</a></li>
	</ul>
</div>
<ul class="dir-list">
	<li><div class="file-icon"></div><a class="" href="/notes/index.html"  >index</a></li>
</ul>
</div>
    </div>
</div>
                        <div class="container">
                                <div class="content"><h1 id="week-1">Week 1</h1>
<div class="toc">
<ul>
<li><a href="#week-1" class="anchor-link">Week 1</a><ul>
<li><a href="#refactoring-the-mvp-into-not-a-mvp" class="anchor-link">Refactoring the MVP into not-a-MVP</a></li>
<li><a href="#questions-for-week-1" class="anchor-link">Questions for Week 1</a></li>
</ul>
</li>
<li><a href="#week-4" class="anchor-link">Week 4</a><ul>
<li><a href="#first-draft-api-implementation" class="anchor-link">First Draft API Implementation</a></li>
<li><a href="#testing-the-draft-api" class="anchor-link">Testing the Draft API</a></li>
</ul>
</li>
<li><a href="#week-5" class="anchor-link">Week 5</a><ul>
<li><a href="#phase-2-transformations-and-opengl" class="anchor-link">Phase 2: Transformations And OpenGL</a><ul>
<li><a href="#the-plan" class="anchor-link">The Plan</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<h2 id="refactoring-the-mvp-into-not-a-mvp">Refactoring the MVP into not-a-MVP</h2>
<p>Spent some time slowly turning the MVP into a draft API in libwayshot. <br />
Some thoughts:   </p>
<ul>
<li>
<p>We need to make libwayshot work in two modes, basically:   </p>
<ul>
<li>
<p>The shm mode in which libwayshot presently works   </p>
<ul>
<li>
<p>Some relevant data-structures:   </p>
<ul>
<li>
<p>FrameCopy:   </p>
<p><code>struct FrameCopy {   
    pub frame_format: FrameFormat,   
    pub frame_color_type: ColorType,   
    pub frame_mmap: MmapMut,   
    pub transform: wl_output::Transform,   
    /// Logical region with the transform already applied.   
    pub logical_region: LogicalRegion,   
    pub physical_size: Size,   
}</code>
 <br />
This struct stores the frame metadata along with the buffer that backs it   </p>
</li>
<li>
<p>FrameGuard:   </p>
<p><code>pub struct FrameGuard {   
    pub buffer: WlBuffer,   
    pub shm_pool: WlShmPool,   
    }</code>
 <br />
This struct serves as a "Guard" for that wayland-rs proxy objects that calls <code>destroy()</code> on them when dropped   </p>
</li>
</ul>
</li>
<li>
<p>The DMA-BUF mode:   </p>
<ul>
<li>In this mode we'll have to store a <code>ZwpLinuxDmabufV1</code> to create the WlBuffers needed for copy(). One instance of this can be reused across multiple frames.   </li>
<li>A GBMDevice to create GBM backing buffer objects on. Again, one instance of this can be reused across frames.   </li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Implemented a new constructor to initialize a GBM Device and store it in the main state of the program <code>WayshotConnection</code>   </p>
<ul>
<li>
<p>Also created a    </p>
<p><code>struct DMABUFState {   
        linux_dmabuf: ZwpLinuxDmabufV1,   
        gbmdev: GBMDevice&lt;Card&gt;,   
    }</code>
 <br />
which stores reusable state for dmabuf mode in WayshotConnection   </p>
<ul>
<li>Not sure if WayshotConnection is the right place for this, presently most of this state for shm screencopy is stored in the intermediate <code>capture_*</code> functions.   </li>
</ul>
</li>
</ul>
</li>
<li>
<p>In general there's stuff that needs to be done once like init, getting output information or creating a screencopy manager with the output and region selected and then there is the stuff that needs to be done every frame: getting the buffer parameters, properly initializing the buffers, and actually copying the frame.   </p>
<ul>
<li>Presently wayshot is not geared to really separate this: for instance, it creates a new screencopy manager for every frame initialized  and it's clearly designed to be a single use screenshot library rather than a continuous screen-capture system.    </li>
<li>I intend to build out the dmabuf functionality in the current framework, will see if it can be refactored out later to more clearly separate the frame capture init from the actual frame capture loop.   </li>
</ul>
</li>
</ul>
<h2 id="questions-for-week-1">Questions for Week 1</h2>
<ul>
<li>How to distribute program state?   <ul>
<li>There are multiple places to store it: <code>WayshotConnection</code>, a mostly unused <code>WayshotState</code> struct and the <code>CaptureFrameState</code> struct   </li>
<li>Some state changes from frame to frame:   <ul>
<li>DMABUF creation parameters like frame formats, frame size, etc   </li>
</ul>
</li>
<li>While other state remains the same between frames:   <ul>
<li>The GBMDevice, the <code>ZwpLinuxDmabufV1</code> proxy object   </li>
</ul>
</li>
</ul>
</li>
<li>How to let intermediate functions know which mode we are in?   <ul>
<li>The protocol logic is presently spread across several functions, we want to reuse as many of these as possible while also allowing them to work with the new buffer type.    </li>
<li>As such, they need to figure out what mode the program is in and act accordingly while setting up the state.   </li>
</ul>
</li>
<li>How to modify the core structs so that they work for both modes?   <ul>
<li>Should the choice between the two modes be made at time of <code>WayshotConnection</code> creation?   <ul>
<li>Or should it be made for each individual frame - this is the natural state of the protocol.   </li>
</ul>
</li>
<li>How to store DMABUFs instead of SHMs in structs like <code>FrameCopy</code> or <code>FrameGuard</code>?   </li>
<li>How to reconcile two different types of frame metadata:    <ul>
<li><code>Buffer</code> events give the parameters for shm mode and is stored in <code>FrameFormat</code> struct in <code>CaptureFrameState</code> presently   </li>
<li>Should the equivalent parameters for <code>dmabuf</code> event be stored in <code>FrameFormat</code> (even though the <code>dmabuf</code> event doesn't give the stride parameter that <code>Buffer</code> gives and <code>FrameFormat</code> requires) or should a new struct be created specifically for storing <code>dmabuf</code> parameters?   </li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="week-4">Week 4</h1>
<p>I spent Weeks 2 and 3 busy with my semester exams. In that time, I outlined a strategy to refactor libwayshot and implemented it in Week 4 after discussing the above questions with my mentors.   </p>
<p>I would modify the core data structures in libwayshot and then make code changes wherever the compiler demands it.  Then I would modify/add whatever functions are required for the API.   </p>
<p>Reading the code, I discovered that there are three levels of abstraction in libwayshot:   </p>
<ul>
<li>The <code>screenshot_*</code> series of functions: These are the public API and mostly wrap around one of the <code>capture_*</code> series of functions.   </li>
<li>The <code>capture_frame_copy*</code> and <code>capture_output_frame_shm_fd</code> series of functions: <code>capture_output_frame_shm_fd</code> is a part of the public libwayshot API  that allows for low-level access to the screencapture data in the form of file descriptors and a <code>FrameGuard</code> struct that contains a <code>WlBuffer</code>. The <code>capture_frame_copy*</code> functions handles the creation of a <code>FrameCopy</code> struct which is a sort of intermediate data structure between raw shared memory and a <code>DynamicImage</code>, these functions are used by the <code>screenshot*</code> function layer above and are not public.   </li>
<li>The <code>capture_output_frame_get_state</code> and <code>capture_output_frame_inner</code> functions: These two functions deal with the nitty-gritty of interacting with the wlr-screencopy protocol. The primary data structure here is <code>CaptureFrameState</code>.   <ul>
<li><code>capture_output_frame_get_state</code> sets up a <a href="https://wayland.app/protocols/wlr-screencopy-unstable-v1#zwlr_screencopy_manager_v1" class="external-link" title="zwlr_screencopy_manager_v1 interface">zwlr_screencopy_manager_v1</a> with the correct sub-region and the output to be captured to get a  <a href="https://wayland.app/protocols/wlr-screencopy-unstable-v1#zwlr_screencopy_frame_v1" class="external-link" title="zwlr_screencopy_frame_v1 interface">zwlr_screencopy_frame_v1</a>    </li>
<li><code>capture_output_frame_inner</code> manages the copy of frame data from the created zwlr_screencopy_frame_v1 into the shared memory buffers.   </li>
<li><code>capture_output_frame_shm_fd</code> and it's sister function <code>capture_output_frame_shm_from_file</code> call the above two functions one after the other to handle everything to do with wlr-screencopy.   </li>
</ul>
</li>
</ul>
<h2 id="first-draft-api-implementation">First Draft API Implementation</h2>
<p>For the first phase I decided to create dmabuf version of the lower two levels of abstraction. My goal was to create a dmabuf equivalent for <code>capture_output_frame_shm_fd</code> which would provide low level access to the dma buffer objects and a wl-buffer.    </p>
<p>To this goal, I created the new function variants <code>capture_output_frame_get_state_dmabuf</code> and <code>capture_output_frame_inner_dmabuf</code> to replicate the lowest layer and <code>capture_output_frame_dmabuf</code> to replicate the public API on the level above. <code>capture_output_frame_dmabuf</code> would return a GBM BufferObject, a FrameGuard containing a WlBuffer and the frame format descriptor.   </p>
<p>Two new structs <code>DMAFrameFormat</code> and <code>DMAFrameGuard</code> were created as counterparts to <code>FrameFormat</code> and <code>FrameGuard</code>.    </p>
<p>For the most part adapting the code from the MVP into these functions was straightforward with the shm variants as a reference.   </p>
<p>One part I have some trouble with is error handling. Using unwrap() in library code is generally frowned upon but I haven't figured out a good way to pass up errors to the caller without running into compiler errors like "? couldn't convert the error to <code>error::Error</code> <br />
the question mark operation (<code>?</code>) implicitly performs a conversion on the error value using the <code>From</code> trait". This requires some research.   </p>
<p>The next phase will be testing. I will need some way to test the new API, ideally without having any VRAM-&gt;CPU copying. The simplest plan is to start with a basic wayland window demo and attach the <code>WlBuffer</code> obtained from the API to a <code>WlSurface</code> and see what the result looks like.    </p>
<h2 id="testing-the-draft-api">Testing the Draft API</h2>
<p>I started with the simple window client <a href="https://github.com/Smithay/wayland-rs/blob/master/wayland-client/examples/simple_window.rs" class="external-link">example</a> from the wayland-rs project. This sample program simply sets up a window and attaches a shared memory backed <code>WlBuffer</code> containing a simple image to a <code>WlSurface</code>. The code is stored in stored in <code>src/examples/waymirror.rs</code>.    </p>
<p>All I had to do was to swap out the shm <code>WlBuffer</code> in the example program with the <code>WlBuffer</code> obtained from the new API at <code>capture_output_frame_dmabuf</code>. I was surprised to find it working out of the box: <br />
<img alt="" src="/notes/_attachments/Pasted%20image%2020240619212710.png" /> <br />
The window on the right mirrors whatever is on the screen via the new API.   </p>
<h1 id="week-5">Week 5</h1>
<p>This is the final week of June and the end of the first month of GSoC. Progress so far has been unexpectedly good mostly because I was able to prepare for the wayland-protocol libwayshot/compositor interactions during the proposal writing period. The pre-existing code could also be shaped into the DMA-BUF versions so I ended up writing surprisingly little new code in the first month and instead ended up refactoring and reshaping a lot of existing code. I also created the <a href="/notes/GSOC/GSoC%20Changelog.html">GSoC Changelog</a> page for tracking changes to the project.   </p>
<p>I can't say the next phase is going to be the same. That phase is going to include a lot more exploration and study as it wasn't really clear to me what shape it would have when I was planning out the project in the proposal. So let's get into the weeds:   </p>
<h2 id="phase-2-transformations-and-opengl">Phase 2: Transformations And OpenGL</h2>
<p>Let's recap the current state of affairs: libwayshot now has an API that provides screencapture data in two formats: a BufferObject managed using gbm-rs and a WlBuffer managed using wayland-rs.   </p>
<p>This is all you need for some applications. The demo app <code>waymirror</code> is one example: all it needs to do is pick up the WlBuffer containing the screen capture data and attach it to a WlSurface to directly draw the screenshot to the window. It does not involve any VRAM-&gt;RAM copies. In a sense this already is a complete on-GPU pipeline for moving around screencapture data in libwayshot.    </p>
<p>So what's next? libwayshot does a lot more than just pass on the screenshot - it can capture specific subregions of the screen, deal with screen rotation, capture regions spanning multiple outputs - merging the result into a single image. The WlBuffer/BufferObject API is of insufficient utility when you want to manipulate the data stored within them - they are designed for moving images around, not manipulating them.    </p>
<p>This is where OpenGL comes in - the plan is to convert the DMABUF screencopy data into GL textures, perform whatever manipulations we need via shaders and then return the results to the user. With this plan the textures will be analogous to the <code>Image</code> objects returned by the present public API.       </p>
<p>One issue here is that I do not have any personal experience directly using OpenGL even if I'm not new to the graphics rendering field. So I'll be spending a week or two learning up on the topic using the tutorial at <a href="https://learnopengl.com/" class="external-link">https://learnopengl.com/</a> with the help of my mentors.   </p>
<h3 id="the-plan">The Plan</h3>
<p>FIrstly, we need to create a OpenGL context. A context basically stores the present state of the OpenGL rendering pipeline. There's a couple of methods of doing this on various platforms but the wlroots native method would via the use of <a href="https://docs.rs/wayland-egl/latest/wayland_egl/index.html" class="external-link">wayland-egl</a>.    </p>
<p>One of my mentors, <a href="https://github.com/Shinyzenith" class="external-link">@Shinyzenith</a> has a demo project at <a href="https://github.com/Shinyzenith/wayland-egl-ctx" class="external-link">wayland-egl-ctx</a>conveniently recreating the OpenGL <a href="https://learnopengl.com/Getting-started/Hello-Triangle" class="external-link">Hello Triangle</a>example via wayland-egl. My plan at this point is to:   </p>
<ul>
<li>Adapt code from that demo to properly initialize EGL and get a working OpenGL pipeline.   </li>
<li>Figure out how to import dmabufs and turn them into textures:   </li>
<li>Return the texture to the API caller   </li>
</ul>
<p>With this preliminary pipeline working, further plans can be made to perform the aforementioned transformations and image merges via the use of OpenGL.</p></div>
<div class="note-footer">
<div class="backlinks">
<h2>Backlinks</h2>
<ul>
	<li><a class="backlink" href="/notes/GSOC/GSOC.html">gsoc</a></li>
</ul>
</div>

<div class="tags">

</div>

</div>
<div class="graph requires_js ">
    <div id="A24387220051270649156174872104909586691{level}" class="graph_div"></div>

    <div class="graph-instructions" id="D24387220051270649156174872104909586691{level}">
        Left-click: follow link, Right-click: select node, Scroll: zoom
    </div>
    
    <div class="graph-button-row" style="display:flex;">
        <button class="graph_button graph_show_button" id="B24387220051270649156174872104909586691{level}" level="{level}" note_temp_id="24387220051270649156174872104909586691" onclick="window.ObsHtmlGraph.run(this, '24387220051270649156174872104909586691', 'gsoc devlog (june)');">
            Show Graph
        </button>
        <button class="graph_button graph_type_button" id="C24387220051270649156174872104909586691{level}" style="flex:1" onclick="window.ObsHtmlGraph.switch_graph_type(this);">
            2D
        </button>
    </div>
</div>

<script type="module">
    if (window.ObsHtmlGraph == undefined){
        import('/notes/obs.html/static/graph.js').then((Module) => {
            window.ObsHtmlGraph = Module;
            window.ObsHtmlGraph.arm_page(document.getElementById('page_holder'))
        })
    }
</script>




                                <!-- end content -->
                        </div>
                        <div class="container_filler">
                        </div>
                        <div id="right_pane" class="right_pane active">
    <div id="right_pane_fold_header" class="right_pane_fold_header fold_header">x</div>
    <div id="right_pane_content" class="right_pane_content">
            
    </div>
</div>
                </div>
        </div>

        <script>
                function handle_toggle_side_bar(e){
                        let header;
                        let pane; 
                        let target = e.target

                        // switch out the navbar button click for a header click
                        if (target.id == 'left_pane_toggle_nav'){
                                target = document.getElementById('left_pane_fold_header')
                        }
                        else if (target.id == 'right_pane_toggle_nav'){
                                target = document.getElementById('right_pane_fold_header')
                        }

                        // get header and pane
                        if (target.classList.contains('fold_header')) {
                                header = target;
                                pane = target.parentElement;
                        }
                        else {
                                pane = target;
                                header = target.getElementsByClassName('fold_header')[0];
                        }
                        toggle_side_bar(pane, header, true)
                        e.stopPropagation();
                }
                function handle_toggle_side_bar_button(e){
                        document.getElementById('menu_toggle_button').click()
                        handle_toggle_side_bar(e);
                }

                function toggle_side_bar(pane, header, save) {
                        let active = (pane.classList.contains('active'))
                        if (active){
                                disable_side_bar(pane, header, save);
                        }
                        else {
                                enable_side_bar(pane, header, save);
                        }
                }
                function enable_side_bar(pane, header, save){
                        pane.classList.add('active');
                        pane.removeEventListener('click', handle_toggle_side_bar);
                        header.addEventListener('click', handle_toggle_side_bar);
                        set_correct_header_symbol(header);
                        if (save){ save_panel_folding_state(header, true) }
                }
                function disable_side_bar(pane, header, save){
                        pane.classList.remove('active');
                        pane.addEventListener('click', handle_toggle_side_bar);
                        header.removeEventListener('click', handle_toggle_side_bar);
                        set_correct_header_symbol(header);
                        if (save){ save_panel_folding_state(header, false) }
                }
                function set_correct_header_symbol(header){
                        let pane = header.parentElement;
                        let symbol = [['>', '<'],['<', '>']]
                        symbol = symbol[Number(header.classList.contains('right_pane_fold_header'))][Number(pane.classList.contains('active'))];
                        console.log(symbol);
                        header.innerHTML = symbol
                        return header;
                }
                function panel_folding_get_panel_name(header){
                        return ['left', 'right'][Number(header.classList.contains('right_pane_fold_header'))]
                }
                function save_panel_folding_state(header, active){
                        ls_set('pane_folding_state_'+panel_folding_get_panel_name(header), Number(active));
                }
                function load_panel_folding_state(panel_name){
                        val = ls_get('pane_folding_state_'+panel_name)
                        if (!val){ return {'exists': false, 'value': null}}
                        return {'exists': true, 'value': Boolean(Number(val))}
                }
                function set_pane_folding_start(left_header, right_header){
                        // small screen = closed
                        let right_pane_enabled = true;
                        let left_pane_enabled = true;
                        let w = window.visualViewport.width
                        if (w < 1000){
                                left_pane_enabled = false
                        }
                        if (w < 800){
                                right_pane_enabled = false
                        }

                        // get saved values if present
                        let rval = load_panel_folding_state('right')
                        if (rval['exists']){
                                right_pane_enabled = rval['value']
                        }
                        let lval = load_panel_folding_state('left')
                        if (lval['exists']){
                                left_pane_enabled = lval['value']
                        }

                        // default = enabled, so we only need to disable
                        if (!left_pane_enabled){
                                disable_side_bar(document.getElementById('left_pane'), document.getElementById('left_pane_fold_header'))
                        }
                        if (!right_pane_enabled){
                                disable_side_bar(document.getElementById('right_pane'), document.getElementById('right_pane_fold_header'))
                        }
                }

                function init_pane_folding(header){
                        set_correct_header_symbol(header);
                        header.addEventListener('click', handle_toggle_side_bar);
                }
                
                
                set_pane_folding_start()
                init_pane_folding(document.getElementById('left_pane_fold_header'));
                init_pane_folding(document.getElementById('right_pane_fold_header'));

                document.getElementById('left_pane_toggle_nav').addEventListener('click', handle_toggle_side_bar_button);
                document.getElementById('right_pane_toggle_nav').addEventListener('click', handle_toggle_side_bar_button);
        </script>

        <script src="/notes/obs.html/static/load_dirtree_footer.js" type="text/javascript"></script>

        




</body>
</html>
